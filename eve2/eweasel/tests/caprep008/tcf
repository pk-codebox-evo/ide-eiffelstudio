
test_name 	capture-protect-wean
test_description Capture and replay objects that are kept on the C side either through protecting them or weak pointers

define MULTITHREADED "false"
define PRECOMPILE "$PRECOMPILED_BASE"

copy_sub 	Ace $TEST Ace
copy_raw 	test.e $CLUSTER test.e
compile_frozen
compile_result 	ok
c_compile_work
c_compile_result	ok


execute_work 	NONE 	exec_capture_output -eif_capture
execute_result 	ok
compare		exec_capture_output output

execute_work	NONE	exec_replay_output -eif_replay
execute_result	ok
compare		exec_replay_output output

cleanup_compile


define MULTITHREADED "true"
define PRECOMPILE "$PRECOMPILED_BASE_MT"

copy_sub        Ace $TEST Ace
copy_raw        test.e $CLUSTER test.e
compile_frozen
compile_result  ok
c_compile_work
c_compile_result        ok


execute_work    NONE    exec_capture_output -eif_capture
execute_result  ok
compare         exec_capture_output output

execute_work    NONE    exec_replay_output -eif_replay
execute_result  ok
compare         exec_replay_output output

test_end
